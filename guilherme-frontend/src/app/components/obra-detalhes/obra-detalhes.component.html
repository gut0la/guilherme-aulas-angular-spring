<div class="detalhes-container">
  <div class="loading-container" *ngIf="loading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Carregando obra...</p>
  </div>

  <div *ngIf="!loading && obra" class="content">
    <div class="header-actions">
      <button mat-icon-button (click)="voltar()" class="back-btn">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h1>Detalhes da Obra</h1>
    </div>

    <mat-card class="obra-card">
      <div class="obra-header">
        <div class="obra-image">
          <mat-icon class="tipo-icon">{{ getTipoIcon(obra.tipo) }}</mat-icon>
          <div class="badges">
            <span class="tipo-badge">{{ obra.tipo }}</span>
            <span class="ano-badge">{{ obra.anoLancamento }}</span>
          </div>
        </div>
        
        <div class="obra-info">
          <h2 class="obra-titulo">{{ obra.titulo }}</h2>
          <p class="obra-autor">
            <mat-icon>person</mat-icon>
            {{ obra.autor }}
          </p>
          
          <div class="generos" *ngIf="obra.generos && obra.generos.length > 0">
            <mat-chip-set>
              <mat-chip *ngFor="let genero of obra.generos">{{ genero.nome }}</mat-chip>
            </mat-chip-set>
          </div>
          
          <div class="rating-display" *ngIf="obra.notaMedia">
            <div class="stars">
              <mat-icon *ngFor="let star of getStars(obra.notaMedia)" class="star">{{ star }}</mat-icon>
            </div>
            <span class="nota-media">{{ obra.notaMedia | number:'1.1-1' }}/10</span>
          </div>
        </div>
      </div>
      
      <mat-card-content>
        <h3>Descrição</h3>
        <p class="obra-descricao">{{ obra.descricao }}</p>
      </mat-card-content>
    </mat-card>
    
    <mat-card class="nova-avaliacao">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>rate_review</mat-icon>
          Adicionar Avaliação
        </mat-card-title>
      </mat-card-header>
      
      <mat-card-content>
        <div class="form-row">
          <mat-form-field appearance="outline" class="nota-field">
            <mat-label>Nota (1-10)</mat-label>
            <input matInput type="number" min="1" max="10" [(ngModel)]="novaAvaliacao.nota">
            <mat-hint>Avalie de 1 a 10</mat-hint>
          </mat-form-field>
          
          <div class="stars-preview">
            <mat-icon *ngFor="let star of getStars(novaAvaliacao.nota)" class="star">{{ star }}</mat-icon>
          </div>
        </div>
        
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Comentário (opcional)</mat-label>
          <textarea matInput rows="4" [(ngModel)]="novaAvaliacao.comentario" placeholder="Compartilhe sua opinião sobre esta obra..."></textarea>
        </mat-form-field>
      </mat-card-content>
      
      <mat-card-actions>
        <button mat-raised-button color="primary" (click)="adicionarAvaliacao()" [disabled]="submitting">
          <mat-spinner *ngIf="submitting" diameter="20" class="spinner"></mat-spinner>
          <mat-icon *ngIf="!submitting">send</mat-icon>
          <span *ngIf="!submitting">Publicar Avaliação</span>
          <span *ngIf="submitting">Publicando...</span>
        </button>
      </mat-card-actions>
    </mat-card>
    
    <div class="avaliacoes-section">
      <h2>
        <mat-icon>reviews</mat-icon>
        Avaliações ({{ avaliacoes.length }})
      </h2>
      
      <mat-card *ngFor="let avaliacao of avaliacoes" class="avaliacao-card">
        <mat-card-content>
          <div class="avaliacao-header">
            <div class="user-info">
              <mat-icon class="user-icon">account_circle</mat-icon>
              <span class="user-name">Usuário {{ avaliacao.usuarioId }}</span>
            </div>
            <div class="rating">
              <div class="stars">
                <mat-icon *ngFor="let star of getStars(avaliacao.nota)" class="star">{{ star }}</mat-icon>
              </div>
              <span class="nota">{{ avaliacao.nota }}/10</span>
            </div>
          </div>
          
          <p class="comentario" *ngIf="avaliacao.comentario">{{ avaliacao.comentario }}</p>
        </mat-card-content>
      </mat-card>
      
      <div *ngIf="avaliacoes.length === 0" class="no-avaliacoes">
        <mat-icon class="empty-icon">rate_review</mat-icon>
        <h3>Nenhuma avaliação ainda</h3>
        <p>Seja o primeiro a avaliar esta obra!</p>
      </div>
    </div>
  </div>
</div>
